---
name: happy-path-mapping
description: Systematically discover all significant user flows in a codebase, prioritize them by business impact, generate HP-XXX files using the standard template, and create a happy-path/ folder with an INDEX.md in the target project. Always asks for user confirmation before persisting any files.
---

# Happy Path Mapping Skill

## When to Use

- Starting QA coverage from scratch on a project
- After a major feature addition that introduced new flows
- Before a release to ensure all critical paths are documented
- When onboarding a new team member who needs to understand what the system does
- Any time someone asks: "what flows do we have?", "create a QA baseline", "map our happy paths"

---

## 5-Step Framework

### Step 1: Flow Discovery (10 min)

**Objective**: Find every significant user-facing flow in the codebase.

**Actions**:
1. Glob for routing files: `**/{routes,router,pages,app}.{js,ts,jsx,tsx}`, `**/routes/**/*.{js,ts}`, `**/pages/**/*.{js,ts,jsx,tsx}`
2. Grep for HTTP verb handlers: `app\.(get|post|put|patch|delete)\(`, `router\.(get|post|put|patch|delete)\(`, `@(Get|Post|Put|Patch|Delete)\(`
3. Grep for navigation patterns: `<Link`, `<NavLink`, `<a href`, `navigate\(`, `router.push(`
4. Grep for form submissions: `onSubmit`, `handleSubmit`, `<form`, `fetch\(.*POST`, `axios\.post(`
5. Read `package.json` to identify framework (Next.js, Express, Fastify, Django, Rails, etc.) and adjust glob patterns accordingly
6. Check `openapi.yaml`, `swagger.json`, or `docs/api/` for documented API endpoints

**Output**: A raw list of all discovered routes, endpoints, and user interactions â€” ungrouped and unfiltered.

---

### Step 2: Flow Prioritization (5 min)

**Objective**: Assign priority to each discovered flow.

**Priority Matrix**:

| Priority | Criteria | Examples |
|----------|----------|---------|
| **P0** | Revenue-generating, authentication, data integrity | Checkout, payment, login, signup, data export |
| **P1** | Core product functionality | Search, create/edit/delete main resource, dashboard load |
| **P2** | Supporting features | Profile settings, notifications, filters, sorting |
| **P3** | Edge cases, admin tools, rarely-used paths | Admin panel, export CSV, bulk operations |

**Actions**:
1. Group discovered routes by domain (auth, checkout, user management, API, admin, etc.)
2. Assign priority based on matrix above
3. Identify which flows have existing HP files (if `happy-path/` folder already exists)
4. Flag flows with no coverage as gaps

**Output**: Prioritized flow list with gaps highlighted.

---

### Step 3: HP File Generation

**Objective**: Create HP-XXX files for each flow, starting with P0.

**Actions**:
1. Assign sequential IDs starting from HP-001 (or the next available number if HP files already exist)
2. For each flow, populate the HP template (see template below)
3. Infer test steps from: route handlers, form field names (grep for `name=`, `id=`, `formik.values`), API request/response shapes
4. Set `status: draft` for all newly generated files â€” user must review before marking `active`
5. **Before writing any file**: use `AskUserQuestion` to present the full list of HP files to be created and ask for confirmation

**HP File Template**:

```markdown
---
id: HP-XXX
name: [Feature/Flow Name]
status: draft
created: YYYY-MM-DD
updated: YYYY-MM-DD
author: qa-engineer
priority: P0 | P1 | P2 | P3
tags: [authentication, checkout, api, ux, etc.]
---

# HP-XXX: [Feature/Flow Name]

## Overview
[1-2 sentence description of what this happy path validates and why it matters]

## Prerequisites
- [ ] Application is running at [base-url]
- [ ] [Required user account or role]
- [ ] [Required data state]
- [ ] [Required environment config]

## Test Steps

### Step 1: [Action Name]
**Action**: [Specific URL, click, form field, API call]
**Expected**: [HTTP status, page content, UI state, response body]
**Actual**: [ ] Pass / [ ] Fail â€” [notes if fail]

### Step N: ...

## Success Criteria
- [ ] [Verifiable outcome 1]
- [ ] [Verifiable outcome 2]
- [ ] No console errors during the entire flow
- [ ] All HTTP responses complete within 3 seconds

## Common Failure Patterns
- **[Failure type]**: [Cause and diagnosis]

## Related Flows
- [HP-XXX: Name] â€” [Why related]

## Notes
[Environment-specific notes, known flakiness, context]
```

**Output**: HP-XXX draft files ready for user review.

---

### Step 4: happy-path/ Folder Setup

**Objective**: Establish the `happy-path/` folder structure in the target project.

**Actions**:
1. Ask user for the target project root (if not already known)
2. Check if `happy-path/` already exists â€” if yes, read existing INDEX.md before modifying
3. Create `happy-path/INDEX.md` with a table of all HP files:

```markdown
# Happy Path Index

Auto-generated by qa-engineer. Last updated: YYYY-MM-DD.

| ID | Name | Priority | Status | Tags |
|----|------|----------|--------|------|
| [HP-001](./HP-001.md) | [Flow Name] | P0 | draft | auth, login |
| [HP-002](./HP-002.md) | [Flow Name] | P1 | draft | checkout |
```

4. Write each approved HP file to `happy-path/HP-XXX.md`
5. Confirm that `happy-path/` is tracked by version control (check `.gitignore` â€” it should NOT be excluded)

**Output**: `happy-path/` folder with INDEX.md and all HP-XXX files.

---

### Step 5: Discovery Summary

**Objective**: Give the user a clear picture of what was found and what to do next.

**Summary Format**:

```
## Happy Path Mapping Summary

**Flows discovered**: [N]
**HP files created**: [N] (P0: N, P1: N, P2: N, P3: N)
**Gaps identified**: [N flows not yet covered]
**Existing HP files updated**: [N]

### Coverage by Domain
| Domain | Flows | HP Files | Coverage |
|--------|-------|----------|----------|
| Auth | 3 | 3 | 100% |
| Checkout | 5 | 3 | 60% âš ï¸ |
| API | 12 | 0 | 0% ðŸ”´ |

### Recommended Next Step
[e.g., "Run bug-hunt on the 3 uncovered checkout flows" or "Mark HP-001 through HP-005 as active after review"]
```

---

## Tips

- If the project uses a monorepo, ask which package/app to map before starting
- For Next.js: focus on `pages/` or `app/` directory; API routes are under `pages/api/` or `app/api/`
- For Express/Fastify: grep `app.use(` and `router.*` to find route registrations
- For mobile apps: focus on screen navigation and API calls, not DOM interactions
- Always check if there's an existing Postman collection, OpenAPI spec, or integration test suite â€” these are goldmines for flow discovery

## Common Mistakes to Avoid

- Do NOT create HP files without user confirmation â€” always `AskUserQuestion` first
- Do NOT put `happy-path/` inside the plugin directory â€” it belongs in the target project
- Do NOT skip P2/P3 flows entirely â€” they often contain edge cases that cause P0 bugs in production
- Do NOT mark HP files as `active` on first generation â€” `draft` until a human has reviewed them
